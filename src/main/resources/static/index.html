<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Web Content Extractor</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <style>
        .logo-text { font-size: 20px; font-weight: 700; color: #fff; }
        .content-box { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
        img, video { border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.12); }
        .small-preview { max-width: 180px; height: auto; object-fit: cover; }
        .muted { color: #6c757d; }
        pre.response { white-space: pre-wrap; word-break: break-word; }
    </style>
</head>
<body style="background:#f4f7fb;">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="#">
            <div style="width:36px;height:36px;background:#fff;border-radius:6px;margin-right:10px;"></div>
            <span class="logo-text">WebScraper</span>
        </a>
    </div>
</nav>

<div class="container mt-5">
    <div class="content-box">
        <h3 class="mb-3 text-primary">Web Content Extractor</h3>

        <div class="mb-2">
            <input id="urlInput" type="text" class="form-control" placeholder="Enter website URL (include http:// or https://)" />
        </div>

        <div class="d-grid mb-2">
            <button id="scrapeBtn" class="btn btn-primary">Scrape Website</button>
        </div>

        <div id="status" class="muted mb-2"></div>

        <hr />

        <h5>Images</h5>
        <div id="images" class="d-flex flex-wrap mb-3"></div>

        <h5>Links</h5>
        <div id="links" class="mb-3"></div>

        <h5>Videos</h5>
        <div id="videos" class="d-flex flex-wrap mb-3"></div>

        <div id="error" class="text-danger"></div>
    </div>
</div>

<script>
    document.getElementById('scrapeBtn').addEventListener('click', scrape);

    async function scrape() {
      clearUi();
      const url = document.getElementById('urlInput').value.trim();
      const statusEl = document.getElementById('status');
      const errorEl = document.getElementById('error');

      if (!url) {
        errorEl.textContent = 'Please enter a URL.';
        return;
      }

      statusEl.textContent = 'Requesting server...';

      // Matches your backend controller: GET /api/scrape?url=...
      const endpoint = `/api/scrape?url=${encodeURIComponent(url)}`;

      try {
        const res = await fetch(endpoint, { method: 'GET' });

        if (!res.ok) {
          // Attempt to read server error message
          let body = '';
          try { body = await res.text(); } catch(e) { /* ignore */ }
          throw new Error(`Server returned ${res.status}${body ? ': ' + body : ''}`);
        }

        const data = await res.json();

        statusEl.textContent = `Received ${lengthOrZero(data.images)} images, ${lengthOrZero(data.links)} links, ${lengthOrZero(data.videos)} videos.`;

        // Images
        const imagesEl = document.getElementById('images');
        (data.images || []).forEach(src => {
          const img = document.createElement('img');
          img.src = src;
          img.alt = 'image';
          img.className = 'm-2 small-preview';
          img.loading = 'lazy';
          imagesEl.appendChild(img);
        });

        // Links
        const linksEl = document.getElementById('links');
        (data.links || []).forEach(href => {
          const p = document.createElement('p');
          p.className = 'mb-1';
          const a = document.createElement('a');
          a.href = href;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.textContent = href;
          p.appendChild(a);
          linksEl.appendChild(p);
        });

        // Videos
        const videosEl = document.getElementById('videos');
        (data.videos || []).forEach(src => {
          const v = document.createElement('video');
          v.controls = true;
          v.className = 'm-2';
          v.width = 320;
          const s = document.createElement('source');
          s.src = src;
          v.appendChild(s);
          videosEl.appendChild(v);
        });

      } catch (err) {
        console.error(err);
        errorEl.textContent = 'Error: ' + (err.message || err);
        statusEl.textContent = '';
      }
    }

    function clearUi() {
      document.getElementById('images').innerHTML = '';
      document.getElementById('links').innerHTML = '';
      document.getElementById('videos').innerHTML = '';
      document.getElementById('error').textContent = '';
      document.getElementById('status').textContent = '';
    }

    function lengthOrZero(x) {
      try { return (x || []).length; } catch { return 0; }
    }
</script>
</body>
</html>
